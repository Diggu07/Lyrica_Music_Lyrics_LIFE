<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Dashboard ‚Äî Lyrica</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>
    <div id="app">
      <main class="container">
        <!-- üåü HEADER -->
        <section class="header">
          <h1 id="welcome">Dashboard</h1>
          <div class="actions">
            <a class="btn btn-ghost" href="music.html">Music</a>
          </div>
        </section>

        <!-- üìä STATS CARDS -->
        <section class="grid">
          <div class="card glass stat">
            <h3>Playlists</h3>
            <p id="playlistsCount">‚Äî</p>
          </div>
          <div class="card glass stat">
            <h3>‚ù§Ô∏è Liked Songs</h3>
            <p id="likedCount">0</p>
          </div>
          <div class="card glass stat">
            <h3>üéß Listening History</h3>
            <p id="historyCount">‚Äî</p>
          </div>
        </section>

        <!-- üî• LEADERBOARD -->
        <section class="card glass" id="leaderboardSection">
          <h3>üî• Top Songs Leaderboard</h3>
          <div id="leaderboard" class="song-list"></div>
        </section>

        <!-- üïí RECENTLY PLAYED -->
        <section class="card glass" id="recentSection">
          <h3>üïí Recently Played</h3>
          <div id="recent" class="song-list"></div>
        </section>

        <!-- üë§ ACCOUNT INFO -->
        <section class="card glass" id="accountSection">
          <h3>Account</h3>
          <div id="userInfo" class="user-info"></div>
          <pre id="rawUser" class="muted small" style="display: none"></pre>
        </section>
      </main>
    </div>

    <!-- ‚ù§Ô∏è Liked Songs Counter Script -->
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const likedCountEl = document.getElementById("likedCount");
        
        try {
          const res = await fetch("/songs/liked");
          if (!res.ok) throw new Error("Backend returned error");
          const data = await res.json();
          
          likedCountEl.textContent = data.length || 0;
          console.log(`‚ù§Ô∏è Liked songs count updated: ${data.length}`);
        } catch (err) {
          console.warn("‚ö†Ô∏è Could not fetch from backend ‚Äî falling back to localStorage:", err);
          
          const localLiked = JSON.parse(localStorage.getItem("likedSongs") || "[]");
          likedCountEl.textContent = localLiked.length || 0;
          console.log(`‚ù§Ô∏è Liked songs count (local): ${localLiked.length}`);
        }
      });
      </script>
    
    <!-- üéß Listening History Count -->
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const historyCountEl = document.getElementById("historyCount");
        
        try {
          const res = await fetch("/songs/recent");
          if (!res.ok) throw new Error("Failed to fetch recent songs");
          const data = await res.json();
          
          console.log("üéß /songs/recent data:", data);
          const totalHistory = Array.isArray(data) ? data.length : 0;
          historyCountEl.textContent = totalHistory;
        } catch (err) {
          console.error("‚ö†Ô∏è Could not update listening history count:", err);
          historyCountEl.textContent = "0";
        }
      });
    </script>
    <!-- ‚úÖ JS Imports -->
    <script src="js/api.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/leaderboard.js"></script>

  </body>
</html>
